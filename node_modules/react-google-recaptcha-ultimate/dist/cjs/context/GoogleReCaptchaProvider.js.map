{"version":3,"file":"GoogleReCaptchaProvider.js","sources":["../../../src/context/GoogleReCaptchaProvider.tsx"],"sourcesContent":["import React from 'react';\n\nimport type { ContainerId, GoogleReCaptcha } from '../utils';\nimport {\n  checkGoogleReCaptchaInjected,\n  hideGoogleReCaptchaBadge,\n  injectGoogleReCaptchaScript,\n  removeGoogleReCaptchaBadge,\n  removeGoogleReCaptchaContainer,\n  removeGoogleReCaptchaScript\n} from '../utils';\n\nimport { GoogleReCaptchaContextProvider } from './GoogleReCaptchaContext';\n\ninterface GoogleReCaptchaDefaultProviderProps {\n  siteKey: string;\n  language?: string;\n  isEnterprise?: boolean;\n  onLoad?: (googleReCaptcha: GoogleReCaptcha.Instance) => Promise<void> | void;\n  onError?: () => Promise<void>;\n  host?: GoogleReCaptcha.Host;\n  children?: React.ReactNode;\n  scriptProps?: GoogleReCaptcha.Script;\n}\n\ninterface Explicit {\n  container?: ContainerId | HTMLElement;\n  tabIndex?: number;\n  inherit?: boolean;\n  callback?: (token: string) => void;\n  errorCallback?: () => void;\n  expiredCallback?: () => void;\n}\n\nexport interface GoogleReCaptchaV2InvisibleProviderProps\n  extends GoogleReCaptchaDefaultProviderProps {\n  type: Extract<GoogleReCaptcha.Type, 'v2-invisible'>;\n  explicit?: Explicit & {\n    badge?: GoogleReCaptcha.Badge;\n  };\n}\nexport interface GoogleReCaptchaV2CheckBoxProviderProps\n  extends GoogleReCaptchaDefaultProviderProps {\n  type: Extract<GoogleReCaptcha.Type, 'v2-checkbox'>;\n  explicit?: Explicit & {\n    container: ContainerId | HTMLElement;\n    action?: GoogleReCaptcha.Action['action'];\n    theme?: GoogleReCaptcha.Theme;\n    size?: GoogleReCaptcha.Size['v2-checkbox'];\n  };\n}\nexport interface GoogleReCaptchaV3ProviderProps extends GoogleReCaptchaDefaultProviderProps {\n  type: Extract<GoogleReCaptcha.Type, 'v3'>;\n  explicit?: Explicit & {\n    badge?: GoogleReCaptcha.Badge;\n  };\n}\n\nexport type GoogleReCaptchaProviderProps =\n  | GoogleReCaptchaV3ProviderProps\n  | GoogleReCaptchaV2InvisibleProviderProps\n  | GoogleReCaptchaV2CheckBoxProviderProps;\n\nconst onLoadCallbackName = 'onGoogleReCaptchaLoad';\nconst containerId = 'google-recaptcha-container';\n\nexport const GoogleReCaptchaProvider: React.FC<GoogleReCaptchaProviderProps> = ({\n  type,\n  siteKey,\n  language,\n  scriptProps,\n  isEnterprise = false,\n  host,\n  children,\n  explicit,\n  onLoad,\n  onError\n}) => {\n  const [isLoading, setIsLoading] = React.useState(true);\n  const [googleReCaptchaInstance, setGoogleReCaptchaInstance] =\n    React.useState<GoogleReCaptcha.Instance>();\n\n  React.useEffect(() => {\n    if (!siteKey) {\n      throw new Error('Google ReCaptcha site key not provided');\n    }\n\n    const scriptId = scriptProps?.id ?? 'google-recaptcha-script';\n    const isGoogleReCaptchaInjected = checkGoogleReCaptchaInjected(scriptId);\n\n    const onload = () => {\n      const googleReCaptcha: GoogleReCaptcha.Instance = isEnterprise\n        ? (window as any).grecaptcha?.enterprise\n        : (window as any).grecaptcha;\n\n      if (!googleReCaptcha) {\n        if (onError) onError();\n        return;\n      }\n\n      if (!explicit) {\n        googleReCaptcha.ready(async () => {\n          setGoogleReCaptchaInstance(googleReCaptcha);\n          if (onLoad) await onLoad(googleReCaptcha);\n          setIsLoading(true);\n        });\n      }\n\n      if (explicit) {\n        const params = {\n          size: type === 'v3' || type === 'v2-invisible' ? 'invisible' : 'normal',\n          ...((type === 'v3' || type === 'v2-invisible') && ({ badge: 'bottomright' } as const)),\n          sitekey: siteKey,\n          ...explicit\n        } as const;\n\n        if (!isGoogleReCaptchaInjected) {\n          const isV3AndV2OptWidgetHidden =\n            (type === 'v3' || type === 'v2-invisible') && explicit?.badge === 'hidden';\n\n          if (isV3AndV2OptWidgetHidden) {\n            hideGoogleReCaptchaBadge();\n          }\n        }\n\n        googleReCaptcha.ready(async () => {\n          if (explicit.container) {\n            googleReCaptcha.render(explicit.container, params, !!explicit.inherit);\n          }\n\n          setGoogleReCaptchaInstance(googleReCaptcha);\n\n          if (onLoad) await onLoad(googleReCaptcha);\n          setIsLoading(true);\n        });\n      }\n    };\n    (window as unknown as { [key: string]: () => void })[onLoadCallbackName] = onload;\n\n    if (isGoogleReCaptchaInjected) {\n      onload();\n    } else {\n      injectGoogleReCaptchaScript({\n        isEnterprise,\n        host,\n        ...((type === 'v3' || type === 'v2-invisible') &&\n          explicit?.badge && {\n            badge: explicit?.badge === 'hidden' ? 'bottomright' : explicit?.badge\n          }),\n        ...(language && { hl: language }),\n        render:\n          ((type === 'v3' || type === 'v2-invisible') && explicit?.container) ||\n          type === 'v2-checkbox'\n            ? 'explicit'\n            : siteKey,\n        ...scriptProps,\n        onload,\n        id: scriptId\n      });\n    }\n\n    return () => {\n      googleReCaptchaInstance?.reset();\n      if (!isGoogleReCaptchaInjected) removeGoogleReCaptchaScript(scriptId);\n      if ((type === 'v3' || type === 'v2-invisible') && !explicit?.container && explicit?.badge) {\n        removeGoogleReCaptchaContainer(containerId);\n      } else {\n        removeGoogleReCaptchaBadge();\n      }\n    };\n  }, [isEnterprise, language, host]);\n\n  const executeV3 = React.useCallback(\n    (action: GoogleReCaptcha.Action['action']) => {\n      if (!googleReCaptchaInstance?.execute) {\n        throw new Error('Google ReCaptcha has not been loaded');\n      }\n\n      return googleReCaptchaInstance.execute(siteKey, { action });\n    },\n    [googleReCaptchaInstance]\n  );\n\n  const executeV2Invisible = React.useCallback(\n    (optWidgetId?: GoogleReCaptcha.OptWidgetId) => {\n      if (!googleReCaptchaInstance?.execute) {\n        throw new Error('Google ReCaptcha has not been loaded');\n      }\n\n      return googleReCaptchaInstance.execute(optWidgetId);\n    },\n    [googleReCaptchaInstance]\n  );\n\n  const value = React.useMemo(\n    () => ({\n      googleReCaptcha: googleReCaptchaInstance,\n      siteKey,\n      isLoading,\n      executeV2Invisible,\n      executeV3,\n      reset: googleReCaptchaInstance?.reset,\n      getResponse: googleReCaptchaInstance?.getResponse,\n      render: googleReCaptchaInstance?.render,\n      ...(language && { language })\n    }),\n    [siteKey, googleReCaptchaInstance, isLoading, language]\n  );\n\n  return <GoogleReCaptchaContextProvider value={value}>{children}</GoogleReCaptchaContextProvider>;\n};\n"],"names":["_ref","type","siteKey","language","scriptProps","_ref$isEnterprise","isEnterprise","host","children","explicit","onLoad","onError","_React$useState","React","useState","_React$useState2","_slicedToArray","isLoading","setIsLoading","_React$useState3","_React$useState4","googleReCaptchaInstance","setGoogleReCaptchaInstance","useEffect","_scriptProps$id","Error","scriptId","id","isGoogleReCaptchaInjected","checkGoogleReCaptchaInjected","onload","_grecaptcha","googleReCaptcha","window","grecaptcha","enterprise","ready","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","stop","params","_objectSpread","_objectSpread2","size","badge","sitekey","hideGoogleReCaptchaBadge","_callee2","_context2","container","render","inherit","injectGoogleReCaptchaScript","hl","reset","removeGoogleReCaptchaScript","removeGoogleReCaptchaBadge","removeGoogleReCaptchaContainer","executeV3","useCallback","action","execute","executeV2Invisible","optWidgetId","value","useMemo","getResponse","createElement","GoogleReCaptchaContextProvider"],"mappings":"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"}